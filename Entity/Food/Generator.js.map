{"version":3,"file":"Generator.js","sourceRoot":"","sources":["../../../src/Entity/Food/Generator.ts"],"names":[],"mappings":";;AAAA,8CAAuC;AACvC,iCAA0B;AAC1B,2CAAoC;AACpC,6CAAqC;AAIrC,MAAqB,SAAU,SAAQ,oBAAU;IAM/C,YAAY,IAAU;QACpB,KAAK,CAAC,IAAI,CAAC,CAAC;QAEZ,IAAI,CAAC,kBAAkB,GAAG,CAAC,CAAC;QAC5B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAEzB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QAEtB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QAEpB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;IACjB,CAAC;IAED,mBAAmB,CAAC,MAAkB;QACpC,IAAI,MAAM,KAAK,IAAI;YAAE,OAAO;QAE5B,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACtD,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;QAEtB,IACE,IAAI,CAAC,YAAY;YACjB,CAAC,MAAM,YAAY,eAAK,IAAI,MAAM,YAAY,gBAAM,CAAC,EACrD;YACA,IAAI,CAAC,kBAAkB,GAAG,EAAE,CAAC;YAC7B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;YAEvC,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAEjD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE,EAAE;gBAClC,MAAM,IAAI,GAAG,IAAI,cAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;gBACnE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;gBAC9B,IAAI,CAAC,UAAU,CAAC,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,GAAG,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;aACvE;SACF;IACH,CAAC;IAED,WAAW,CAAC,MAAc,EAAE,UAAmB;QAC7C,IAAI,UAAU,EAAE;YACd,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAA;YACZ,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACzB,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACb,MAAM,CAAC,EAAE,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;SAChC;QAED,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC3B,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC3B,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACjD,CAAC;IAED,IAAI,CAAC,IAAY;QACf,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,GAAG,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAE/D,IAAI,CAAC,kBAAkB,IAAI,GAAG,CAAC;QAE/B,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACnB,CAAC;CACF;AAlED,4BAkEC","sourcesContent":["import BaseEntity from \"../BaseEntity\";\nimport Food from \"./Food\";\nimport Flail from \"../Player/Flail\";\nimport Player from \"../Player/Player\"\nimport Game from \"../../Game\";\nimport { Writer } from \"../../Coder\";\n\nexport default class Generator extends BaseEntity {\n  private lastHitTick: number;\n  private hitCooldown: number;\n  private animationSizeAddon: number;\n  private canShootFood: boolean;\n\n  constructor(game: Game) {\n    super(game);\n\n    this.animationSizeAddon = 0;\n    this.canShootFood = true;\n\n    this.lastHitTick = 0;\n    this.hitCooldown = 10;\n\n    this.knockback = 5;\n    this.resistance = 0;\n\n    this.collides = true;\n    this.detectsCollision = true;\n    this.size = 50;\n  }\n\n  onCollisionCallback(entity: BaseEntity) {\n    if (entity === this) return;\n\n    const delta = this.position.subtract(entity.position);\n    const dir = delta.dir;\n\n    if (\n      this.canShootFood &&\n      (entity instanceof Flail || entity instanceof Player)\n    ) {\n      this.animationSizeAddon = 10;\n      this.lastHitTick = this.game.tickCount;\n\n      const foodCount = Math.sqrt(entity.velocity.mag);\n\n      for (let i = 0; i < foodCount; i++) {\n        const food = new Food(this.game, Math.random() < 0.9 ? 200 : 1000);\n        food.position = this.position;\n        food.applyForce(dir + Math.random() * 0.3 - 0.15, Math.random() * 30);\n      }\n    }\n  }\n\n  writeBinary(writer: Writer, isCreation: boolean) {\n    if (isCreation) {\n      writer.vu(1)\n      writer.string(this.name);\n      writer.vu(0);\n      writer.vu(0x00FF00 | 33554432);\n    }\n\n    writer.vi(this.position.x);\n    writer.vi(this.position.y);\n    writer.vu(this.size + this.animationSizeAddon);\n  }\n\n  tick(tick: number) {\n    this.canShootFood = this.lastHitTick < tick - this.hitCooldown;\n\n    this.animationSizeAddon *= 0.7;\n\n    super.tick(tick);\n  }\n}\n"]}